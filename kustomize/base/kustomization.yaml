apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Namespace for all resources
namespace: sysdig-shield

# Common labels applied to all resources
commonLabels:
  app.kubernetes.io/name: sysdig-shield
  app.kubernetes.io/managed-by: argocd

# Resources organized by sync wave
resources:
  # Wave 0: Namespace
  - 00-namespace.yaml

  # Wave 1: RBAC
  - rbac/sysdig-agent-serviceaccount.yaml
  - rbac/sysdig-agent-clusterrole.yaml
  - rbac/sysdig-agent-clusterrolebinding.yaml
  - rbac/admission-controller-serviceaccount.yaml
  - rbac/admission-controller-clusterrole.yaml
  - rbac/admission-controller-clusterrolebinding.yaml
  - rbac/node-analyzer-serviceaccount.yaml
  - rbac/node-analyzer-clusterrole.yaml
  - rbac/node-analyzer-clusterrolebinding.yaml
  - rbac/kspm-collector-serviceaccount.yaml
  - rbac/kspm-collector-clusterrole.yaml
  - rbac/kspm-collector-clusterrolebinding.yaml

  # Wave 2: ConfigMaps and Network Policies
  - sysdig-agent/configmap.yaml
  - node-analyzer/configmap.yaml
  - admission-controller/configmap.yaml
  - kspm-collector/configmap.yaml
  - network-policies/default-deny.yaml
  - network-policies/sysdig-agent-egress.yaml
  - network-policies/admission-controller-ingress.yaml
  - network-policies/admission-controller-egress.yaml
  - network-policies/node-analyzer-egress.yaml
  - network-policies/kspm-collector-egress.yaml
  - network-policies/dns-egress.yaml

  # Wave 3: DaemonSets (Agents)
  - sysdig-agent/daemonset.yaml
  - node-analyzer/daemonset.yaml

  # Wave 4: Deployments and Services
  - admission-controller/deployment.yaml
  - admission-controller/service.yaml
  - admission-controller/poddisruptionbudget.yaml
  - kspm-collector/deployment.yaml

  # Wave 5: Webhook Configurations
  - admission-controller/validatingwebhookconfiguration.yaml
